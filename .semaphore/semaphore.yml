version: v1.0
name: Continuous Integration Pipelines
agent:
  machine:
    type: f1-standard-2
    os_image: ubuntu2004
  containers:
    - name: appium
      image: "appium/appium:latest"  # Official Appium Docker image
    - name: database
      image: 'registry.semaphoreci.com/postgres:11'

blocks: 
  - name: Run Appium Test and Capture Screenshot
    dependencies: []
    task:
      jobs:
        - name: Run Appium Test
          commands:
            - checkout
            - curl -sSL https://r2r.us/Appium/appium-install.sh | bash  # If not using pre-built Docker image with appium installed
            - appium &  # Start Appium server
            - sleep 10  # Ensure Appium is ready
            - node appium_test.js  # Run the Appium test script
            - node capture_screenshot.js  # Capture screenshot using Appium
            - mv screenshot.png /tmp/screenshot.png  # Move screenshot to /tmp
            - artifact push job /tmp/screenshot.png  # Push screenshot as artifact
